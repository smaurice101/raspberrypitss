
     apiVersion: apps/v1
     kind: Deployment
     metadata:
       name: tml-server-v1-plugin-3f10-ml_restapi
     spec:
       selector:
         matchLabels:
           app: tml-server-v1-plugin-3f10-ml_restapi
       replicas: 3 # tells deployment to run 1 pods matching the template
       template:
         metadata:
           labels:
             app: tml-server-v1-plugin-3f10-ml_restapi
         spec:
           containers:
           - name: tml-server-v1-plugin-3f10-ml_restapi
             image: maadsdocker/tml-server-v1-plugin-3f10-ml_restapi-amd64:latest
             volumeMounts:
             - name: dockerpath
               mountPath: /var/run/docker.sock
             - name: rawdata
               mountPath: /rawdata  # container folder where the local folder will be mounted
             ports:
             - containerPort: 9002
             - containerPort: 4040
             - containerPort: 6060
             - containerPort: 5050
             env:
             - name: TSS
               value: '0'
             - name: PROJECTNAME
               value: 'tml-server-v1-plugin-3f10'               
             - name: SOLUTIONNAME
               value: 'tml-server-v1-plugin-3f10-ml_restapi'
             - name: SOLUTIONDAG
               value: 'solution_preprocessing_ml_restapi_dag-tml-server-v1-plugin-3f10'
             - name: GITUSERNAME
               value: 'smaurice101'
             - name: GITREPOURL
               value: 'https://github.com/smaurice101/raspberrypitss.git'
             - name: SOLUTIONEXTERNALPORT
               value: '5050'
             - name: CHIP
               value: 'amd64'
             - name: SOLUTIONAIRFLOWPORT
               value: '4040'
             - name: SOLUTIONVIPERVIZPORT
               value: '6060'
             - name: DOCKERUSERNAME
               value: 'maadsdocker'
             - name: CLIENTPORT
               value: '9002'
             - name: EXTERNALPORT
               value: '39399'
             - name: KAFKACLOUDUSERNAME
               value: ''
             - name: VIPERVIZPORT
               value: '49689'
             - name: MQTTUSERNAME
               value: 'smaurice'
             - name: AIRFLOWPORT
               value: '9000'
             - name: GITPASSWORD
               valueFrom:
                 secretKeyRef:
                  name: tmlsecrets 
                  key: githubtoken                       
             - name: KAFKACLOUDPASSWORD
               valueFrom:
                 secretKeyRef:
                  name: tmlsecrets 
                  key: kafkacloudpassword                      
             - name: MQTTPASSWORD
               valueFrom: 
                 secretKeyRef:
                   name: tmlsecrets 
                   key: mqttpass                        
             - name: READTHEDOCS
               valueFrom:
                 secretKeyRef:
                   name: tmlsecrets 
                   key: readthedocs          
             - name: qip 
               value: 'privategpt-service' # This is private GPT service in kubernetes
             - name: KUBE
               value: '1'
             - name: step3localfileinputfile # STEP 3 localfile inputfile field can be adjusted here.
               value: ''
             - name: step3localfiledocfolder # STEP 3 # STEP 3 docfolder inputfile field can be adjusted here.
               value: ''
             - name: step4maxrows # STEP 4 maxrows field can be adjusted here.  Higher the number more data to process, BUT more memory needed.
               value: '-1'
             - name: step4bmaxrows # STEP 4b maxrows field can be adjusted here.  Higher the number more data to process, BUT more memory needed.
               value: '-1'
             - name: step4cmaxrows # STEP 4c maxrows field can be adjusted here.  Higher the number more data to process, BUT more memory needed.
               value: '-1'
             - name: step4crawdatatopic # STEP 4c
               value: ''               
             - name: step4csearchterms # STEP 4c 
               value: ''
             - name: step4crememberpastwindows # STEP 4c 
               value: ''
             - name: step4cpatternwindowthreshold # STEP 4c 
               value: ''
             - name: step4crtmsscorethreshold # STEP 4c 
               value: ''
             - name: step4cattackscorethreshold # STEP 4c 
               value: ''
             - name: step4cpatternscorethreshold # STEP 4c 
               value: '' 
             - name: step4crtmsstream # STEP 4c 
               value: ''                              
             - name: step4clocalsearchtermfolder # STEP 4c 
               value: ''                              
             - name: step4clocalsearchtermfolderinterval # STEP 4c 
               value: ''                                             
             - name: step4crtmsfoldername # STEP 4c 
               value: ''                                                                                          
             - name: step4crtmsmaxwindows # STEP 4c adjust RTMSMAXWINDOWS for Step 4c
               value: ''                           
             - name: step2raw_data_topic # STEP 2 
               value: 'iot-raw-data'                           
             - name: step2preprocess_data_topic # STEP 2 
               value: 'iot-preprocess,iot-preprocess2'                           
             - name: step4raw_data_topic # STEP 4
               value: 'iot-raw-data'                           
             - name: step4preprocess_data_topic # STEP 4
               value: 'iot-preprocess'                                          
             - name: step4preprocesstypes # STEP 4
               value: 'anomprob,trend,avg'                                          
             - name: step4jsoncriteria # STEP 4
               value: 'uid=metadata.dsn,filter:allrecords~subtopics=metadata.property_name~values=datapoint.value~identifiers=metadata.display_name~datetime=datapoint.updated_at~msgid=datapoint.id~latlong=lat:long'                           
             - name: step4ajsoncriteria # STEP 4a 
               value: ''                           
             - name: step4amaxrows # STEP 4a
               value: ''                           
             - name: step4apreprocesstypes # STEP 4a
               value: ''                           
             - name: step4araw_data_topic # STEP 4a
               value: ''                           
             - name: step4apreprocess_data_topic # STEP 4a
               value: ''                           
             - name: step4bpreprocesstypes # STEP 4b
               value: ''                           
             - name: step4bjsoncriteria # STEP 4b
               value: ''                           
             - name: step4braw_data_topic # STEP 4b 
               value: ''                           
             - name: step4bpreprocess_data_topic # STEP 4b 
               value: ''                           
             - name: step5rollbackoffsets # STEP 5 rollbackoffsets field can be adjusted here.  Higher the number more training data to process, BUT more memory needed.
               value: '1000'                  
             - name: step5processlogic # STEP 5 processlogic field can be adjusted here.  
               value: 'classification_name=failure_prob:Power_preprocessed_AnomProb=55,n'                                 
             - name: step5independentvariables # STEP 5 independent variables can be adjusted here.  
               value: 'Power_preprocessed_AnomProb'                                                               
             - name: step6maxrows # STEP 6 maxrows field can be adjusted here.  Higher the number more predictions to make, BUT more memory needed.
               value: '50'                              
             - name: step9rollbackoffset # STEP 9 rollbackoffset field can be adjusted here.  Higher the number more information sent to privateGPT, BUT more memory needed.
               value: '-1'                                             
             - name: step9prompt # STEP 9 Enter PGPT prompt
               value: ''                  
             - name: step9context # STEP 9 Enter PGPT context
               value: ''             
             - name: step9keyattribute
               value: '' # Step 9 key attribtes change as needed  
             - name: step9keyprocesstype
               value: '' # Step 9 key processtypes change as needed                                
             - name: step9hyperbatch
               value: '' # Set to 1 if you want to batch all of the hyperpredictions and sent to chatgpt, set to 0, if you want to send it one by one   
             - name: step9vectordbcollectionname
               value: ''   # collection name in Qdrant
             - name: step9concurrency # privateGPT concurency, if greater than 1, multiple PGPT will run
               value: ''
             - name: CUDA_VISIBLE_DEVICES
               value: '' # 0 for any device or specify specific number 
             - name: step9docfolder # privateGPT docfolder to load files in Qdrant vectorDB local context
               value: ''
             - name: step9docfolderingestinterval # privateGPT docfolderingestinterval, number of seconds to wait before reloading files in docfolder
               value: ''
             - name: step9useidentifierinprompt # privateGPT useidentifierinprompt, if 1, add TML output json field Identifier, if 0 use prompt
               value: ''               
             - name: step9searchterms # privateGPT searchterms, terms to search for in the chat response
               value: ''                              
             - name: step9streamall # privateGPT streamall, if 1, stream all responses, even if search terms are missing, 0, if response contains search terms
               value: ''                                             
             - name: step9temperature # privateGPT LLM temperature between 0 and 1 i.e. 0.3, if 0, LLM model is conservative, if 1 it hallucinates
               value: ''                                             
             - name: step9vectorsearchtype # privateGPT for QDrant VectorDB similarity search.  Must be either Cosine, Manhattan, Dot, Euclid
               value: ''               
             - name: step9contextwindowsize # privateGPT for contextwindow size
               value: ''                    
             - name: step9pgptcontainername # privateGPT container name
               value: ''                    
             - name: step9pgpthost # privateGPT host ip i.e.: http://127.0.0.1
               value: ''                    
             - name: step9pgptport # privateGPT port i.e. 8001
               value: ''                                   
             - name: step9vectordimension # privateGPT vector dimension
               value: ''                    
             - name: step9brollbackoffset
               value: ''
             - name: step9bdeletevectordbcount
               value: ''
             - name: step9bvectordbpath
               value: ''
             - name: step9btemperature
               value: ''
             - name: step9bvectordbcollectionname
               value: ''
             - name: step9bollamacontainername
               value: ''
             - name: step9bCUDA_VISIBLE_DEVICES
               value: ''
             - name: step9bmainip
               value: ''
             - name: step9bmainport
               value: ''
             - name: step9bembedding
               value: ''
             - name: step9bagents_topic_prompt
               value: ''
             - name: step9bteamlead_topic
               value: ''
             - name: step9bteamleadprompt
               value: ''
             - name: step9bsupervisor_topic
               value: ''
             - name: step9bagenttoolfunctions
               value: ''
             - name: step9bagent_team_supervisor_topic
               value: ''               
             - name: step9bcontextwindow
               value: ''                              
             - name: step9bagenttopic
               value: ''                              
             - name: step9blocalmodelsfolder
               value: ''                              
             - name: step1solutiontitle # STEP 1 solutiontitle field can be adjusted here. 
               value: 'TML REST API Server Plugin'                              
             - name: step1description # STEP 1 description field can be adjusted here. 
               value: 'This is a TML server plug-in that uses REST API - allowing access from ANY application'        
             - name: KUBEBROKERHOST
               value: 'kafka-service:9092'         
             - name: KAFKABROKERHOST
               value: '127.0.0.1:9092'                              
           volumes: 
           - name: dockerpath
             hostPath:
               path: /var/run/docker.sock
           - name: rawdata
             hostPath:
               path: /mnt  # CHANGE AS NEEDED TO YOUR LOCAL FOLDER the paths will be specific to your environment
   ---
     apiVersion: v1
     kind: Service
     metadata:
       name: tml-server-v1-plugin-3f10-ml_restapi-visualization-service
       labels:
         app: tml-server-v1-plugin-3f10-ml_restapi-visualization-service
     spec:
       type: ClusterIP
       ports:
       - port: 80 # Ingress port, if using port 443 will need to setup TLS certs
         name: p1
         protocol: TCP
         targetPort: 6060
       selector:
         app: tml-server-v1-plugin-3f10-ml_restapi
   ---
     apiVersion: v1
     kind: Service
     metadata:
       name: tml-server-v1-plugin-3f10-ml_restapi-external-service
       labels:
         app: tml-server-v1-plugin-3f10-ml_restapi-external-service
     spec:
       type: ClusterIP
       ports:
       - port: 80 # Ingress port, if using port 443 will need to setup TLS certs
         name: p2
         protocol: TCP
         targetPort: 9002
       selector:
         app: tml-server-v1-plugin-3f10-ml_restapi