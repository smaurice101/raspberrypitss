
     apiVersion: apps/v1
     kind: Deployment
     metadata:
       name: tml-multi-agenticai-iot-3f10-ml_agenticai
     spec:
       selector:
         matchLabels:
           app: tml-multi-agenticai-iot-3f10-ml_agenticai
       replicas: 3 # tells deployment to run 1 pods matching the template
       template:
         metadata:
           labels:
             app: tml-multi-agenticai-iot-3f10-ml_agenticai
         spec:
           containers:
           - name: tml-multi-agenticai-iot-3f10-ml_agenticai
             image: maadsdocker/tml-multi-agenticai-iot-3f10-ml_agenticai-amd64:latest
             volumeMounts:
             - name: dockerpath
               mountPath: /var/run/docker.sock
             - name: rawdata
               mountPath: /rawdata   # container folder where the local folder will be mounted                           
             ports:
             - containerPort: 5050
             - containerPort: 4040
             - containerPort: 6060
             env:
             - name: TSS
               value: '0'
             - name: PROJECTNAME
               value: 'tml-multi-agenticai-iot-3f10'                              
             - name: SOLUTIONNAME
               value: 'tml-multi-agenticai-iot-3f10-ml_agenticai'
             - name: SOLUTIONDAG
               value: 'solution_preprocessing_ml_agenticai_dag-tml-multi-agenticai-iot-3f10'
             - name: GITUSERNAME
               value: 'smaurice101'
             - name: GITREPOURL
               value: 'https://github.com/smaurice101/raspberrypitss.git'
             - name: SOLUTIONEXTERNALPORT
               value: '5050'
             - name: CHIP
               value: 'amd64'
             - name: SOLUTIONAIRFLOWPORT
               value: '4040'
             - name: SOLUTIONVIPERVIZPORT
               value: '6060'
             - name: DOCKERUSERNAME
               value: 'maadsdocker'
             - name: CLIENTPORT
               value: '0'
             - name: EXTERNALPORT
               value: '39399'
             - name: KAFKACLOUDUSERNAME
               value: ''
             - name: VIPERVIZPORT
               value: '49689'
             - name: MQTTUSERNAME
               value: 'smaurice'
             - name: AIRFLOWPORT
               value: '9000'
             - name: GITPASSWORD
               valueFrom:
                 secretKeyRef:
                  name: tmlsecrets 
                  key: githubtoken                       
             - name: KAFKACLOUDPASSWORD
               valueFrom:
                 secretKeyRef:
                  name: tmlsecrets 
                  key: kafkacloudpassword                      
             - name: MQTTPASSWORD
               valueFrom: 
                 secretKeyRef:
                   name: tmlsecrets 
                   key: mqttpass                        
             - name: READTHEDOCS
               valueFrom:
                 secretKeyRef:
                   name: tmlsecrets 
                   key: readthedocs          
             - name: qip 
               value: 'privategpt-service' # This is private GPT service in kubernetes
             - name: KUBE
               value: '1'
             - name: step3localfileinputfile # STEP 3 localfile inputfile field can be adjusted here.
               value: '/rawdatademo/IoTData.txt'
             - name: step3localfiledocfolder # STEP 3 # STEP 3 docfolder inputfile field can be adjusted here.
               value: ''               
             - name: step4maxrows # STEP 4 maxrows field can be adjusted here.  Higher the number more data to process, BUT more memory needed.
               value: '-1'
             - name: step4bmaxrows # STEP 4b maxrows field can be adjusted here.  Higher the number more data to process, BUT more memory needed.
               value: '-1'               
             - name: step4cmaxrows # STEP 4c maxrows field can be adjusted here.  Higher the number more data to process, BUT more memory needed.
               value: '-1'               
             - name: step4crawdatatopic # STEP 4c
               value: ''               
             - name: step4csearchterms # STEP 4c 
               value: ''               
             - name: step4crememberpastwindows # STEP 4c 
               value: ''               
             - name: step4cpatternwindowthreshold # STEP 4c 
               value: ''               
             - name: step4crtmsscorethreshold # STEP 4c 
               value: '' 
             - name: step4cattackscorethreshold # STEP 4c 
               value: '' 
             - name: step4cpatternscorethreshold # STEP 4c 
               value: ''                
             - name: step4crtmsstream # STEP 4c 
               value: ''                              
             - name: step4clocalsearchtermfolder # STEP 4c 
               value: ''                              
             - name: step4clocalsearchtermfolderinterval # STEP 4c 
               value: ''                                                            
             - name: step4crtmsfoldername # STEP 4c 
               value: ''                                                                           
             - name: step4crtmsmaxwindows # STEP 4c adjust RTMSMAXWINDOWS for Step 4c
               value: ''                                       
             - name: step2raw_data_topic # STEP 2 
               value: 'iot-raw-data,agent-responses,team-lead-responses,supervisor-responses,all-agents-responses'                           
             - name: step2preprocess_data_topic # STEP 2 
               value: 'iot-preprocess,iot-preprocess2'                           
             - name: step4raw_data_topic # STEP 4
               value: 'iot-raw-data'                           
             - name: step4preprocess_data_topic # STEP 4
               value: 'iot-preprocess'                                                         
             - name: step4preprocesstypes # STEP 4
               value: 'anomprob,trend,avg'                                                         
             - name: step4jsoncriteria # STEP 4
               value: 'uid=metadata.dsn,filter:allrecords~subtopics=metadata.property_name~values=datapoint.value~identifiers=metadata.display_name~datetime=datapoint.updated_at~msgid=datapoint.id~latlong=lat:long'                           
             - name: step4ajsoncriteria # STEP 4a 
               value: ''                           
             - name: step4amaxrows # STEP 4a
               value: ''                           
             - name: step4apreprocesstypes # STEP 4a
               value: ''                           
             - name: step4araw_data_topic # STEP 4a
               value: ''                           
             - name: step4apreprocess_data_topic # STEP 4a
               value: ''                           
             - name: step4bpreprocesstypes # STEP 4b
               value: ''                           
             - name: step4bjsoncriteria # STEP 4b
               value: ''                           
             - name: step4braw_data_topic # STEP 4b 
               value: ''                           
             - name: step4bpreprocess_data_topic # STEP 4b 
               value: ''                                          
             - name: step5rollbackoffsets # STEP 5 rollbackoffsets field can be adjusted here.  Higher the number more training data to process, BUT more memory needed.
               value: '600'                              
             - name: step5processlogic # STEP 5 processlogic field can be adjusted here.  
               value: 'classification_name=failure_prob:Power_preprocessed_AnomProb=55,n'                                                
             - name: step5independentvariables # STEP 5 independent variables can be adjusted here.  
               value: 'Power_preprocessed_AnomProb'                                                                              
             - name: step6maxrows # STEP 6 maxrows field can be adjusted here.  Higher the number more predictions to make, BUT more memory needed.
               value: '50'                              
             - name: step9rollbackoffset # STEP 9 rollbackoffset field can be adjusted here.  Higher the number more information sent to privateGPT, BUT more memory needed.
               value: '-1'                  
             - name: step9prompt # STEP 9 Enter PGPT prompt
               value: ''                  
             - name: step9context # STEP 9 Enter PGPT context
               value: ''                                 
             - name: step9keyattribute
               value: '' # Step 9 key attribtes change as needed  
             - name: step9keyprocesstype
               value: '' # Step 9 key processtypes change as needed                                               
             - name: step9hyperbatch
               value: '' # Set to 1 if you want to batch all of the hyperpredictions and sent to chatgpt, set to 0, if you want to send it one by one   
             - name: step9vectordbcollectionname
               value: ''   # collection name in Qdrant
             - name: step9concurrency # privateGPT concurency, if greater than 1, multiple PGPT will run
               value: ''
             - name: CUDA_VISIBLE_DEVICES
               value: '' # 0 for any device or specify specific number                
             - name: step9docfolder # privateGPT docfolder to load files in Qdrant vectorDB local context
               value: ''
             - name: step9docfolderingestinterval # privateGPT docfolderingestinterval, number of seconds to wait before reloading files in docfolder
               value: ''
             - name: step9useidentifierinprompt # privateGPT useidentifierinprompt, if 1, add TML output json field Identifier, if 0 use prompt
               value: ''                              
             - name: step9searchterms # privateGPT searchterms, terms to search for in the chat response
               value: ''                                             
             - name: step9streamall # privateGPT streamall, if 1, stream all responses, even if search terms are missing, 0, if response contains search terms
               value: ''                                                            
             - name: step9temperature # privateGPT LLM temperature between 0 and 1 i.e. 0.3, if 0, LLM model is conservative, if 1 it hallucinates
               value: ''                                             
             - name: step9vectorsearchtype # privateGPT for QDrant VectorDB similarity search.  Must be either Cosine, Manhattan, Dot, Euclid
               value: ''                                                                           
             - name: step9contextwindowsize # context window size
               value: ''                                                                                          
             - name: step9pgptcontainername # privateGPT container name
               value: ''                    
             - name: step9pgpthost # privateGPT host ip i.e.: http://127.0.0.1
               value: ''                    
             - name: step9pgptport # privateGPT port i.e. 8001
               value: ''                                                  
             - name: step9vectordimension # privateGPT vector dimension
               value: ''                                                                 
             - name: step9brollbackoffset
               value: '15'
             - name: step9bdeletevectordbcount
               value: '5'
             - name: step9bvectordbpath
               value: '/rawdata/vectordb'
             - name: step9btemperature
               value: '0.1'
             - name: step9bvectordbcollectionname
               value: 'tml-llm-model-v2'
             - name: step9bollamacontainername
               value: 'maadsdocker/tml-privategpt-with-gpu-nvidia-amd64-llama3-tools'
             - name: step9bCUDA_VISIBLE_DEVICES
               value: '0'
             - name: step9bmainip
               value: 'http://127.0.0.1'
             - name: step9bmainport
               value: '11434'
             - name: step9bembedding
               value: 'nomic-embed-text'
             - name: step9bagents_topic_prompt
               value: 'iot-preprocess<<-You are a precise data analysis assistant. Your task is to point out any anomalies or interesting insights that could help improve the performance and functioning of         IoT device.  The json data are from IOT devices.  the hp field shows the data that are processed for the process variable (pv), using the process types (pt) like:         avg or average, or trend analysis, or anomprob (i.e. anomaly probability) etc.  The device being processed is in the uid field of the json.         here is the json data:              <<data>>         INSTRUCTIONS:         1. Examine each number in the json array         2. Provide a brief analysis of the results                  FORMAT YOUR RESPONSE:         - Filtered results: [list the qualifying numbers with their "uid" fields]         - Count of qualifying numbers: [number]         - Analysis: [brief explanation of what the filter revealed]                  Be precise and concise in your response.->>        iot-ml-prediction-results-output<<-You are a precise data analysis assistant. Your task is to filter and analyze numeric data based on specified criteria.        TASK: Filter numbers from the given json array using the threshold: greater than 90        Input JSON arrary:              <<data>>         INSTRUCTIONS:         1. Examine each number in the json array         2. Apply the filter condition: number > 90         3. Return only numbers that meet the criteria with their "uid" fields         4. If no numbers meet the criteria, explicitly state this         5. Provide a brief analysis of the results                  FORMAT YOUR RESPONSE:         - Filtered results: [list the qualifying numbers with their "uid" fields]         - Count of qualifying numbers: [number]         - Analysis: [brief explanation of what the filter revealed]                  Be precise and concise in your response.'
             - name: step9bteamlead_topic
               value: 'team-lead-responses'
             - name: step9bteamleadprompt
               value: 'Analyze the dataset containing IoT device monitoring records managed by individual agents.           Review all data fields to determine whether there are any issues or major concerns requiring urgent attention.           Focus on the following criteria:          1. Each record contains a unique device identifier stored in the field "uid".          2. Examine the failure probability for each device stored in the hp field.          3. Categorize the probabilities as follows:           - Low: 0% to 50%           - Medium: 51% to 75%           - High: 76% to 89%           - Urgent: 90% to 100%          Tasks:         - Identify and highlight devices (by their "uid") that have **urgent failure probabilities** (≥ 90%).         - For each flagged device, provide details and reasoning on why it may require immediate investigation.         - Only include devices that meet the urgent threshold. Do not report on low, medium, or high categories unless relevant for context.         - State clearly whether the identified issue is *urgent*.         - Do not use or generate any code, perform a reasoning-based analysis directly from the provided data.'
             - name: step9bsupervisor_topic
               value: 'supervisor-responses'
             - name: step9bagenttoolfunctions
               value: 'send_email<<-send_email<<- You are an email-sending agent. Use smtp parameters to send emails when there is an anomaly in the data, make sure to                     indicate the device name in the mainuid field. do not write a smtp script, actually send the email using the SMTP parameters                     smtp_server='smtp.gmail.com'                     smtp_port=587                     username='sebastian.maurice@gmail.com'                     password=                     sender='sebastian.maurice@gmail.com'                     recipient='sebastian.maurice@otics.ca,sebastian.maurice@gmail.com,smaurice@firstgenesis.com'                     subject=                     body=->>        average<<-average<<-You are an average agent.  Take average of the device failure probabilities.'
             - name: step9bagent_team_supervisor_topic
               value: 'all-agents-responses'                              
             - name: step9bcontextwindow
               value: '4096'                                             
             - name: step9bagenttopic
               value: 'agent-responses'                              
             - name: step9blocalmodelsfolder
               value: '/mnt/c/maads/tml-airflow/rawdata/ollama'                                             
             - name: step1solutiontitle # STEP 1 solutiontitle field can be adjusted here. 
               value: 'TML Multi-Agentic AI Solution for IoT '                              
             - name: step1description # STEP 1 description field can be adjusted here. 
               value: 'This is an awesome TML Multi-Agentic AI real-time solution for IoT device monitoring built by TSS'                                          
             - name: KUBEBROKERHOST
               value: 'kafka-service:9092'         
             - name: KAFKABROKERHOST
               value: '127.0.0.1:9092'                              
           volumes: 
           - name: dockerpath
             hostPath:
               path: /var/run/docker.sock
           - name: rawdata
             hostPath:
               path: /mnt  # CHANGE AS NEEDED TO YOUR LOCAL FOLDER the paths will be specific to your environment
   ---
     apiVersion: v1
     kind: Service
     metadata:
       name: tml-multi-agenticai-iot-3f10-ml_agenticai-visualization-service
       labels:
         app: tml-multi-agenticai-iot-3f10-ml_agenticai-visualization-service
     spec:
       type: ClusterIP
       ports:
       - port: 80 # Ingress port, if using port 443 will need to setup TLS certs
         name: p1
         protocol: TCP
         targetPort: 6060
       selector:
         app: tml-multi-agenticai-iot-3f10-ml_agenticai